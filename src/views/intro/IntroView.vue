<template>
  <!-- <LoadingBar style="position: fixed;width: 1000px;z-index: -1;" :progress="progress"></LoadingBar> -->
  <main>
    <div>
      <h2>{{ $t("frontpage_intro") }}</h2>
      <!-- <h2 v-ellipsis="{ maxLine: 1, maxWidth: '2000px', transitionTime: '1s',wrappable:true }">
        最大宽度2000px 最大行数1 过渡时间1秒
        Lorem ipsum dolor sit amet consectetur illum omnis sunt in, quam eaque tempore ex consequuntur tempora. Totam quis
        minima sit natus eius quos aut soluta optio temporibus exercitationem? Blanditiis expedita tempore sit molestiae,
        ipsam quisquam ullam nostrum accusantium hic, optio distinctio animi doloremque a soluta dolor explicabo possimus!
        Autem neque sed earum commodi quidem doloribus? Ducimus, consequuntur tenetur placeat quidem voluptas minus est
        rem velit sint voluptatibus hic consequatur, in fugit quas voluptate consectetur autem aspernatur. Tempore,
        repellendus cumque aspernatur ea aliquam dicta!
      </h2> -->
      <!-- <h3 v-ellipsis="{ maxLine: 3, transitionMode: 'ease-in-out' }">
        最大宽度默认 最大行数3 过渡函数ease-in-out flex子元素最大宽度失效Lorem ipsum dolor sit amet consectetur adipisicing elit. Labore corporis
        dolor distinctio enim nisi magni nesciunt ea, vitae assumenda atque illum maiores nobis ipsam, quae eos officia?
        Perferendis dignissimos enim, ducimus fuga ab voluptatibus fugit ex dicta a provident illum, aliquid alias
        repellat quasi sit laboriosam corporis suscipit dolorem deserunt sapiente est rerum veniam. Nobis exercitationem
        quo asperiores recusandae odio deleniti! Mollitia, nisi velit! Blanditiis architecto suscipit, quos similique
        facere quibusdam quia quae nesciunt recusandae sapiente vel doloribus! Nostrum, earum! Possimus, incidunt
        quibusdam quaerat quam ab aut! Doloremque aut doloribus vel maiores facilis. Laborum pariatur sunt, assumenda
        architecto tenetur veniam? Eveniet quae natus id quia. Voluptates deleniti explicabo recusandae quia! Minus omnis
        iure itaque est beatae quam commodi alias accusamus! Corporis soluta magnam, ex error exercitationem, harum
        pariatur necessitatibus maiores ad, perspiciatis rerum eum commodi. Ipsa facere tenetur consequatur neque debitis
        rem, ab minima similique odio iusto alias voluptatibus at ducimus, ipsam corrupti unde, ex vitae repellat odit.
        Perspiciatis quas quaerat facere odit ducimus et aspernatur consectetur deleniti temporibus. Minima maxime
        consequatur perspiciatis itaque distinctio consectetur rem minus voluptatem, accusantium ipsa natus modi
        reiciendis quam soluta nihil nemo quod, facilis eos laudantium alias, molestiae dolores dignissimos autem. Beatae
        iusto est saepe nemo assumenda exercitationem. Doloremque, consequuntur aut veritatis aperiam voluptatum mollitia
        velit. Saepe, quas deleniti explicabo iusto dicta itaque autem. Impedit labore veritatis et nostrum omnis eligendi
        explicabo sit nemo! Perspiciatis, laborum ipsa aliquam fugiat magnam corporis aliquid, eos deserunt accusamus
        doloremque eaque. Quo repellat ab, eius eveniet explicabo impedit quaerat quam dolore totam, atque optio iusto
        alias. Est a ut laboriosam mollitia, quidem aperiam ipsum expedita odit repudiandae consequuntur quo ex fuga
        fugiat qui illo quisquam alias ipsa dolore magnam ea placeat explicabo. Voluptatem quod quia et culpa aperiam
        optio aspernatur sit illo eaque aliquid, sequi ratione nam. Cumque, quaerat corporis voluptas vel necessitatibus
        facere quas nesciunt eius quasi deserunt quae, delectus pariatur, explicabo odio temporibus. Facilis doloremque
        saepe praesentium beatae dolor rem, magnam nisi recusandae, ipsa sunt dolorem enim pariatur voluptatem quod maxime
        exercitationem veritatis voluptate debitis non nam corrupti ex. Eos totam tempora dolores asperiores pariatur
        recusandae modi ad tenetur! Et exercitationem ipsa consequuntur reiciendis laborum fugit soluta enim suscipit,
        iusto porro iste unde modi excepturi omnis vitae qui atque explicabo accusamus aliquam facilis quia corrupti
        dignissimos? Eligendi consectetur itaque rerum laborum provident quasi aperiam, tenetur in veritatis quaerat.
        Tempora, reiciendis recusandae ipsum placeat deserunt numquam delectus nam cupiditate minima, distinctio molestias
        natus voluptate ducimus. Consequatur ducimus quo officia, reiciendis voluptas ipsa, debitis odit ipsam illo totam
        similique, ad recusandae nihil fugit. Explicabo, culpa, nesciunt aut asperiores tempore esse autem expedita iusto
        unde enim exercitationem sunt rem est aliquam, natus vitae. Suscipit ipsam illo molestiae eligendi maiores nihil
        accusamus nesciunt quae facere culpa. Vero dolorem facere rem aliquid reiciendis, saepe dolorum sint quisquam
        laborum doloribus sapiente possimus? Dolorum voluptatem labore soluta sed eius dolore cupiditate cum, maxime quo
        obcaecati velit animi. Voluptatem officiis saepe fugit voluptatum velit cumque tempore perferendis architecto
        optio sint mollitia neque ipsam, rerum fugiat itaque, ut ratione eaque nostrum suscipit ea ab quae. Illo
        temporibus praesentium, tempore minus magni iste velit! Quo eos repellat earum consectetur dignissimos, quidem
        culpa quod beatae molestiae incidunt aliquid magnam libero provident explicabo. Facilis eius mollitia quos soluta
        dignissimos accusamus saepe sed, sint voluptas porro. In cupiditate eum, quas itaque, dolorum mollitia asperiores
        impedit odio neque perferendis veniam ad sint, iste molestiae assumenda expedita saepe ducimus facilis suscipit
        dolorem dolores. A corporis quo tenetur ratione officiis veniam quidem modi laudantium? Unde, labore itaque
        molestias quisquam velit quam officiis doloribus obcaecati deleniti quasi? Ut debitis consectetur blanditiis sunt
        fugiat earum? Molestias expedita dolore blanditiis odit, asperiores maiores nam sequi odio modi! Quo alias, rem
        recusandae nisi assumenda cumque consequuntur voluptatem labore esse maiores inventore! Nulla obcaecati itaque
        doloribus vel similique officiis modi illum ad sed minima alias animi consequuntur dolores, possimus labore
      </h3> -->
      <div class="huge-input-wrapper">
        <input
          class="basic-input huge-input"
          type="text"
          :placeholder="$t('huge_input_placeholder')"
          v-model="searchKeyword"
          @keydown.down="navigateDown"
          @keydown.up="navigateUp"
          @keydown.enter="searchOrChangeContent"
          @focus="showAutoCompleteMenu"
          @blur="hideAutoCompleteMenu"
        />
        <ul v-if="autoCompleteShouldShow && autoCompleteLists.length > 0">
          <li
            :class="{ 'suggestion-active': index === activeSuggestionIndex }"
            v-for="(item, index) in autoCompleteLists"
            :key="index"
            @mouseover="activeSuggestionIndex = index"
            @click="changeContent(item.display_name)"
          >
            {{ item.display_name }}
          </li>
        </ul>
        <svg
          @click="basicSearch"
          t="1699356103686"
          class="icon search-icon"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="4162"
          width="200"
          height="200"
        >
          <path
            d="M945.066667 898.133333l-189.866667-189.866666c55.466667-64 87.466667-149.333333 87.466667-241.066667 0-204.8-168.533333-373.333333-373.333334-373.333333S96 264.533333 96 469.333333 264.533333 842.666667 469.333333 842.666667c91.733333 0 174.933333-34.133333 241.066667-87.466667l189.866667 189.866667c6.4 6.4 14.933333 8.533333 23.466666 8.533333s17.066667-2.133333 23.466667-8.533333c8.533333-12.8 8.533333-34.133333-2.133333-46.933334zM469.333333 778.666667C298.666667 778.666667 160 640 160 469.333333S298.666667 160 469.333333 160 778.666667 298.666667 778.666667 469.333333 640 778.666667 469.333333 778.666667z"
            p-id="4163"
          ></path>
        </svg>
      </div>
    </div>
  </main>
</template>

<script>
import LoadingBar from "../../components/loading-bar/LoadingBar.vue";
import i18n from "../../language";
import { AutoComplete } from '../../api/autocomplete.js';

export default {
  name: "IntroView",
  components: {
    LoadingBar,
    i18n,
  },
  data() {
    return {
      searchKeyword: "", // 搜索关键字
      autoCompleteLists: [],
      activeSuggestionIndex: -1,
      autoCompleteShouldShow: false,
    };
  },
  watch: {
    searchKeyword(newValue, oldValue) {
      if (newValue.length == 0) {
        setTimeout(() => {
          this.autoCompleteLists = [];
        }, 100);
      } else {
        this.autoComplete();
      }
    },
  },
  methods: {
    basicSearch() {
      if (this.searchKeyword != "") {
        // alert('搜索关键字：' + this.searchKeyword)
        // this.searchKeyword = ''
        const searchdata = {
          filter: "",
          search: this.searchKeyword,
          sort: "",
          perpage: "10",
          page: "1",
          cursor: "",
          search_type: 1,
        };

        let userId = this.$cookies.get("user_id");
        if (userId == null) {
          alert("未登录");
        } else {
          // console.log(userId)
          this.$router.push({
            path: "/search_result",
            query: searchdata,
          });
        }
      }
    },

    hideAutoCompleteMenu() {
      setTimeout(() => {
        this.autoCompleteShouldShow = false
        this.activeSuggestionIndex = -1
      }, 100)
    },
    autoComplete() {
      let data = {
        q: this.searchKeyword,
        entity_type: ""
      };
      console.log(data);
      AutoComplete.getAutoAllInfo(data).then((res)=>{
        console.log(data)
        this.autoCompleteLists = res.data.results; 
      })
    },
    showAutoCompleteMenu() {
      this.activeSuggestionIndex = -1;
      this.autoCompleteShouldShow = true;
    },

    searchOrChangeContent() {
      if (this.activeSuggestionIndex === -1) {
        this.search()
      } else {
        this.changeContent(this.autoCompleteLists[this.activeSuggestionIndex].display_name)
      }
    },
    navigateDown() {
      if (this.activeSuggestionIndex < this.autoCompleteLists.length - 1) {
        this.activeSuggestionIndex++;
      } else {
        this.activeIndex = 0;
      }
    },
    navigateUp() {
      if (this.activeSuggestionIndex > 0) {
        this.activeSuggestionIndex--;
      } else {
        this.activeSuggestionIndex = this.autoComplete.length - 1;
      }
    },
  },
};
</script>

<style scoped>
main {
  height: calc(100vh - 80px);
  min-height: 400px;
  display: flex;
  justify-content: center;
  align-items: center;
}

main > div {
  display: flex;
  max-width: 900px;
  flex-wrap: wrap;
  justify-content: center;
}

main h2 {
  font-size: 80px;
  color: var(--theme-color);
  font-weight: bold;
  padding-bottom: 50px;

  transition-property: font-size;
  transition: 0.5s cubic-bezier(0.075, 0.82, 0.165, 1);
}

.icon {
  width: 50px;
  height: 50px;
  background-size: cover;
  cursor: pointer;
  transition: 1s cubic-bezier(0.075, 0.82, 0.165, 1);
  fill: #666;
}

.icon:hover {
  scale: 1.2;
  fill: var(--theme-color);
}

.search-icon {
  position: absolute;
  right: 15px;
  z-index: 10;
}

@media screen and (max-width: 850px) {
  .icon {
    width: 40px;
    height: 40px;
  }
}

@media screen and (max-width: 600px) {
  main h2 {
    font-size: 60px;
  }
}

@media screen and (max-width: 450px) {
  main h2 {
    font-size: 40px;
  }
}



</style>